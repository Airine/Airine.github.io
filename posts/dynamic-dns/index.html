<!DOCTYPE html>
<html lang="zh-CN" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-162317692-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="ä¸€å£é—°å¿ƒ" />
	
	
	
	<title>æ£€æµ‹å¤–ç½‘IPå˜åŒ–ï¼ŒåŠ¨æ€æ›´æ–°é˜¿é‡Œäº‘åŸŸåè§£æ ï½œ ä¸€å£é—°å¿ƒ</title>
	
    
    
    <meta name="description" content="ç½®åŠå®½å¸¦åï¼Œè¿è¥å•†ä¸€èˆ¬ä¼šç»™çŒ«ï¼ˆè·¯ç”±å™¨ï¼‰çš„WANç½‘å£åˆ†é…ä¸€ä¸ªå¤–ç½‘IPã€‚å†é€šè¿‡ç«¯å£æ˜ å°„ï¼ˆport forwardingï¼‰åŠŸèƒ½ï¼Œå°±èƒ½è¿œç¨‹sshè®¿é—®å®¶é‡Œçš„è®¾å¤‡ï¼ˆPC/æ ‘è“æ´¾ï¼‰æˆ–è€…å°†å…¶ä½œä¸ºæœåŠ¡å™¨ä½¿ç”¨ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å°†æˆ‘çš„åŸŸå@.aaron-xin.techè§£æåˆ°äº†è¯¥å¤–ç½‘IPã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œçªç„¶æœ‰ä¸€å¤©ï¼Œçªç„¶æ‰€æœ‰æœåŠ¡éƒ½æ— æ³•è®¿é—®äº†ï¼Œä½†æ˜¯IPè¿˜æ˜¯èƒ½å¤Ÿpingé€šã€‚æ’æŸ¥åå‘ç°ï¼Œå¤–ç½‘IPä¹Ÿæ˜¯é€šè¿‡DHCPçš„æ–¹å¼è·å–çš„ï¼Œæ„å‘³ç€æ¯æ¬¡leaseæ›´æ–°çš„æ—¶å€™ï¼Œæœ‰æ¯”è¾ƒå¤§çš„æ¦‚ç‡IPä¼šå‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥ï¼Œæˆ‘é€šè¿‡å®¶ä¸­çš„æ ‘è“æ´¾å®æ—¶ï¼ˆæ¯å°æ—¶ï¼‰ç›‘æ§å¤–ç½‘IPçš„å˜åŒ–ï¼Œå¹¶æ ¹æ®æ–°çš„å¤–ç½‘IPè°ƒç”¨é˜¿é‡Œäº‘APIæ›´æ–°åŸŸåè§£æã€‚
" />
    

    
    
    <meta name="keywords" content="ä¸€å£é—°å¿ƒ, ç”°é—°å¿ƒ, Airine" />
    

	
    
    <link rel="shortcut icon" href="https://www.aaron-xin.tech/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://www.aaron-xin.techcss/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://www.aaron-xin.tech/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://www.aaron-xin.tech/css/highlight.css" />

    
    

    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/c9abd2b4.js","daovoice")</script>
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">ä¸»é¡µ</a>
            </li>
            
            <li>
                <a href="/posts/">å½’æ¡£</a>
            </li>
            
            <li>
                <a href="/tags/">æ ‡ç­¾</a>
            </li>
            
            <li>
                <a href="/about/">å…³äº</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://www.aaron-xin.tech">
                    <span>ä¸€å£é—°å¿ƒ</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">å¿ƒæ€€æµªæ¼«å®‡å®™ï¼Œçæƒœäººé—´æ—¥å¸¸ã€‚</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/Airine" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/airine0119/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://www.zhihu.com/people/tian-run-xin-49" title="zhihu" target="_blank"><i class="ri-zhihu-fill"></i></a>
                
                
                <a href="https://www.aaron-xin.tech/index.xml" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/dynamic-dns/'>æ£€æµ‹å¤–ç½‘IPå˜åŒ–ï¼ŒåŠ¨æ€æ›´æ–°é˜¿é‡Œäº‘åŸŸåè§£æ</a></h2>
                        <span class="date">2021.01.13</span>
                    </div>
                    <div class="post_content markdown"><p>ç½®åŠå®½å¸¦åï¼Œè¿è¥å•†ä¸€èˆ¬ä¼šç»™çŒ«ï¼ˆè·¯ç”±å™¨ï¼‰çš„WANç½‘å£åˆ†é…ä¸€ä¸ªå¤–ç½‘IPã€‚å†é€šè¿‡ç«¯å£æ˜ å°„ï¼ˆport forwardingï¼‰åŠŸèƒ½ï¼Œå°±èƒ½è¿œç¨‹sshè®¿é—®å®¶é‡Œçš„è®¾å¤‡ï¼ˆPC/æ ‘è“æ´¾ï¼‰æˆ–è€…å°†å…¶ä½œä¸ºæœåŠ¡å™¨ä½¿ç”¨ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å°†æˆ‘çš„åŸŸå<code>@.aaron-xin.tech</code>è§£æåˆ°äº†è¯¥å¤–ç½‘IPã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œçªç„¶æœ‰ä¸€å¤©ï¼Œçªç„¶æ‰€æœ‰æœåŠ¡éƒ½æ— æ³•è®¿é—®äº†ï¼Œä½†æ˜¯IPè¿˜æ˜¯èƒ½å¤Ÿpingé€šã€‚æ’æŸ¥åå‘ç°ï¼Œå¤–ç½‘IPä¹Ÿæ˜¯é€šè¿‡DHCPçš„æ–¹å¼è·å–çš„ï¼Œæ„å‘³ç€æ¯æ¬¡leaseæ›´æ–°çš„æ—¶å€™ï¼Œæœ‰æ¯”è¾ƒå¤§çš„æ¦‚ç‡IPä¼šå‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥ï¼Œæˆ‘é€šè¿‡å®¶ä¸­çš„æ ‘è“æ´¾å®æ—¶ï¼ˆæ¯å°æ—¶ï¼‰ç›‘æ§å¤–ç½‘IPçš„å˜åŒ–ï¼Œå¹¶æ ¹æ®æ–°çš„å¤–ç½‘IPè°ƒç”¨é˜¿é‡Œäº‘APIæ›´æ–°åŸŸåè§£æã€‚</p>
<h2 id="ç›®å½•">ç›®å½•</h2>
<ol>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%9C%B0%E5%9D%80">è·å–åŸŸåè§£æIP</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%AE%9E%E6%97%B6%E5%A4%96%E7%BD%91%E5%9C%B0%E5%9D%80">è·å–å®æ—¶å¤–ç½‘IP</a></li>
<li><a href="#%E6%9B%B4%E6%96%B0%E9%98%BF%E9%87%8C%E4%BA%91%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90">æ›´æ–°é˜¿é‡Œäº‘åŸŸåè§£æ</a></li>
<li><a href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC">å¼€æœºè‡ªåŠ¨è¿è¡Œè„šæœ¬</a></li>
</ol>
<p><em>ğŸ‘‡å¯ä»¥çœ‹å‡ºï¼ŒWANå£IPåœ°å€éœ€è¦é€šè¿‡DHCPè·å–ï¼Œå¹¶ä¸”lease timeä¸ºä¸€å¤©</em></p>
<p><img src="https://img-upic.oss-accelerate.aliyuncs.com/uPic/ZkO7XN.png" alt="image-20210114110321075"></p>
<h2 id="è·å–åŸŸåè§£æåœ°å€">è·å–åŸŸåè§£æåœ°å€</h2>
<p>ç¬¬ä¸€æ­¥ï¼Œè·å–åŸŸåè§£æåˆ°çš„IPåœ°å€ï¼ˆæ—§åœ°å€ï¼‰ã€‚é¦–å…ˆæƒ³åˆ°ç”¨æœ€å¸¸è§çš„<code>ping</code>å‘½ä»¤ï¼Œå†ä»<code>ping</code>çš„è¾“å‡ºä¸­è§£æå‡ºæƒ³è¦çš„IPåœ°å€ã€‚</p>
<p><img src="https://img-upic.oss-accelerate.aliyuncs.com/uPic/KA2yiN.png" alt="image-20210114150956913" style="zoom:80%;" /></p>
<p>ä½†æ˜¯è¿™ç§åŠæ³•æœ‰ä¸€ç‚¹é£é™©ï¼Œå¦‚æœæ—§çš„IPåœ°å€æ²¡æœ‰è¢«DHCPåˆ†é…ç»™åˆ«äººï¼Œå°±ä¼šå‡ºç°<code>ping</code>ä¸é€šçš„æƒ…å†µã€‚æ‰€ä»¥æœ€è‡ªç„¶æœ€ä¿é™©çš„åŠæ³•åº”è¯¥æ˜¯å»åšDNS Lookupï¼Œå¯¹åº”çš„Linux Commandå°±æ˜¯<code>dig &lt;domain name&gt;</code>:</p>
<p><img src="https://img-upic.oss-accelerate.aliyuncs.com/uPic/R7bfaH.png" alt="image-20210114151755817" style="zoom:80%;" /></p>
<p>å¯ä»¥é€šè¿‡å·¦è¾¹çš„æ–¹å¼ï¼Œç›´æ¥ä»æœ€è¿‘çš„DNS serverï¼Œä¹Ÿå°±æ˜¯<code>192.168.0.1#53</code>æŸ¥è¯¢ã€‚ä¹Ÿå¯ä»¥æŒ‡å®š<code>8.8.8.8#53</code>(Googleçš„DNS server)ã€‚</p>
<p>å¯¹åº”çš„<code>Golang</code>ä»£ç ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">getResolver</span><span class="p">()</span> <span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">Resolver</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">net</span><span class="p">.</span><span class="nx">Resolver</span><span class="p">{</span>
		<span class="nx">PreferGo</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">Dial</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="nx">address</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">d</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Dialer</span><span class="p">{</span>
				<span class="nx">Timeout</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nf">DialContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;udp&#34;</span><span class="p">,</span> <span class="s">&#34;8.8.8.8:53&#34;</span><span class="p">)</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// DNS lookup
</span><span class="c1"></span><span class="nx">ips</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">resolver</span><span class="p">.</span><span class="nf">LookupHost</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="s">&#34;aaron-xin.tech&#34;</span><span class="p">)</span>
<span class="nx">dnsIP</span> <span class="p">=</span> <span class="nx">ips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><h2 id="è·å–å®æ—¶å¤–ç½‘åœ°å€">è·å–å®æ—¶å¤–ç½‘åœ°å€</h2>
<p>ç¬¬äºŒæ­¥ï¼Œå®æ—¶è·å–å¤–ç½‘IPåœ°å€ã€‚å­ç½‘ä¸­æ¯ä¸€ä¸ªè®¾å¤‡éƒ½é€šè¿‡åŒä¸€å¤–ç½‘IPä¸å¤–ç½‘é“¾æ¥ã€‚å› ä¸ºæ¯æ¬¡HTTP/HTTPsçš„GETéƒ½ä¼šåŒ…å«è¯¥è¯·æ±‚çš„å¤–ç½‘IPåœ°å€ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç½‘ç«™åˆ©ç”¨æ­¤åŠŸèƒ½æä¾›â€IP Lookupâ€œçš„åŠŸèƒ½ã€‚å¦‚æˆ‘ä½¿ç”¨çš„<a href="https://ifconfig.me"><code>ifconfig.me</code></a>:</p>
<p><img src="https://img-upic.oss-accelerate.aliyuncs.com/uPic/JmVjjh.png" alt="image-20210114153813708" style="zoom:80%;" /></p>
<p>å¯¹åº”çš„<code>Golang</code>ä»£ç ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">realIP</span> <span class="kt">string</span>
<span class="c1">// Get real IP
</span><span class="c1"></span><span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;http://ifconfig.me&#34;</span><span class="p">)</span> <span class="c1">// the ip discover service, choose a nearby one
</span><span class="c1"></span><span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
    <span class="nx">body</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="nx">realIP</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Fail to get ip from ifconfig.me&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><h2 id="æ›´æ–°é˜¿é‡Œäº‘åŸŸåè§£æ">æ›´æ–°é˜¿é‡Œäº‘åŸŸåè§£æ</h2>
<p>ç¬¬ä¸‰æ­¥ï¼Œæ›´æ–°é˜¿é‡Œäº‘åŸŸåè§£æã€‚è¿™ä¸ªéœ€è¦é€šè¿‡è°ƒç”¨é˜¿é‡Œäº‘çš„<a href="https://help.aliyun.com/document_detail/124923.html">åŸŸåè§£æAPI</a>å®Œæˆã€‚</p>
<p>é˜¿é‡Œäº‘äº‘è§£æDNSè°ƒç”¨TOP5çš„æ¥å£ï¼š</p>
<ol>
<li>é€šè¿‡ <a href="https://help.aliyun.com/document_detail/29772.html?spm=a2c4g.11186623.2.23.118327a7POR9m1">AddDomainRecord</a> æ ¹æ®ä¼ å…¥å‚æ•°æ·»åŠ è§£æè®°å½•ã€‚</li>
<li>é€šè¿‡ <a href="https://help.aliyun.com/document_detail/29774.html?spm=a2c4g.11186623.2.24.118327a7POR9m1">UpdateDomainRecord</a> æ ¹æ®ä¼ å…¥å‚æ•°ä¿®æ”¹è§£æè®°å½•ã€‚</li>
<li>é€šè¿‡ <a href="https://help.aliyun.com/document_detail/29776.html?spm=a2c4g.11186623.2.25.118327a7POR9m1">DescribeDomainRecords</a> æ ¹æ®ä¼ å…¥å‚æ•°è·å–æŒ‡å®šä¸»åŸŸåçš„æ‰€æœ‰è§£æè®°å½•åˆ—è¡¨ã€‚</li>
<li>é€šè¿‡ <a href="https://help.aliyun.com/document_detail/29778.html?spm=a2c4g.11186623.2.26.118327a7POR9m1">DescribeSubDomainRecords</a> æ ¹æ®ä¼ å…¥å‚æ•°è·å–æŸä¸ªå›ºå®šå­åŸŸåçš„æ‰€æœ‰è§£æè®°å½•åˆ—è¡¨ã€‚</li>
<li>é€šè¿‡ <a href="https://help.aliyun.com/document_detail/29777.html?spm=a2c4g.11186623.2.27.118327a7POR9m1">DescribeDomainRecordInfo</a> æ ¹æ®ä¼ å…¥å‚æ•°è·å–æŸä¸ªå›ºå®šå­åŸŸåä¸‹çš„è§£æè®°å½•ä¿¡æ¯ã€‚</li>
</ol>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ˜¯<code>UpdateDomainRecord</code>å’Œ<code>DescribeDomainRecords</code>ã€‚é€šè¿‡DescribeDomainRecordè·å–å¯¹åº”åŸŸåè§£æè®°å½•çš„Record IDï¼Œä½¿ç”¨Record IDä½œä¸ºå‚æ•°è°ƒç”¨<code>UpdateDomainRecord</code>ä¿®æ”¹å¯¹åº”è§£æè®°å½•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-Go" data-lang="Go"><span class="kd">func</span> <span class="nf">descRecords</span><span class="p">(</span><span class="nx">domain</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

<span class="kd">func</span> <span class="nf">updateDomainRecord</span><span class="p">(</span><span class="nx">ipAddr</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">recordID</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

<span class="k">if</span> <span class="nx">dnsIP</span> <span class="o">!=</span> <span class="nx">realIP</span> <span class="p">{</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;IPs do not match, requesting DNS change...&#34;</span><span class="p">)</span>
	<span class="nx">recordID</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">descRecords</span><span class="p">(</span><span class="nx">domain</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nf">updateDomainRecord</span><span class="p">(</span><span class="nx">realIP</span><span class="p">,</span> <span class="nx">recordID</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å®Œæ•´ä»£ç å¯å‚è€ƒ <a href="https://gist.github.com/Airine/2e6b751ecec5f52f3ca859213037d176">dynamicDNS.go</a></p>
<h2 id="å¼€æœºè‡ªåŠ¨è¿è¡Œè„šæœ¬">å¼€æœºè‡ªåŠ¨è¿è¡Œè„šæœ¬</h2>
<p>æœ€åä¸€æ­¥ï¼Œå¼€æœºè‡ªåŠ¨è¿è¡Œè„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬æˆ‘è·‘åœ¨æ ‘è“æ´¾ä¸Šï¼Œæ ‘è“æ´¾è£…çš„ç³»ç»Ÿæ˜¯ubuntu@20.14 Serverã€‚å› ä¸ºæ ‘è“æ´¾å¯èƒ½ä¼šå­˜åœ¨çªç„¶å®•æœºçš„å¯èƒ½ï¼Œå¦‚æœæ¯æ¬¡æ‰‹åŠ¨è¿è¡Œè„šæœ¬æ¯”è¾ƒéº»çƒ¦ã€‚ä¹Ÿæœ‰å¯èƒ½åœ¨æ ‘è“æ´¾å®•æœºçš„æ—¶å€™ï¼Œå¤–ç½‘IPåˆšå¥½å‘ç”Ÿäº†å˜åŒ–ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨æ ‘è“æ´¾æ¯æ¬¡å¼€æœºååœ¨åå°è‡ªåŠ¨è¿è¡Œæ£€æŸ¥IPå˜åŒ–çš„è„šæœ¬ã€‚å¼€æœºè‡ªåŠ¨è¿è¡Œçš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨äº†ç¼–å†™<code>/etc/rc.local</code>è„šæœ¬çš„æ–¹å¼ã€‚<code>/etc/rc.local</code>æ˜¯ä¸€ä¸ª<code>.sh</code>è„šæœ¬ï¼Œä¼šåœ¨ç³»ç»Ÿå¯åŠ¨å<strong>ä»¥<code>root</code>èº«ä»½æ‰§è¡Œå‘½ä»¤</strong>ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡<code>sudo touch /etc/rc.local</code>åˆ›å»ºæˆ–è€…<code>sudo vim /etc/rc.local</code>åˆ›å»ºå¹¶ç¼–è¾‘ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/sh -e
</span><span class="cp"></span><span class="c1">#</span>
<span class="c1"># rc.local</span>
<span class="c1">#</span>
<span class="c1"># This script is executed at the end of each multiuser runlevel.</span>
<span class="c1"># Make sure that the script will &#34;exit 0&#34; on success or any other</span>
<span class="c1"># value on error.</span>
<span class="c1">#</span>
<span class="c1"># In order to enable or disable this script just change the execution</span>
<span class="c1"># bits.</span>
<span class="c1">#</span>
<span class="c1"># By default this script does nothing.</span>

<span class="c1"># Log</span>
<span class="nb">exec</span> 2&gt; /tmp/rc.local.log  <span class="c1"># send stderr from rc.local to a log file</span>
<span class="nb">exec</span> 1&gt;<span class="p">&amp;</span><span class="m">2</span>                  <span class="c1"># send stdout to the same log file</span>
<span class="nb">set</span> -x                     <span class="c1"># tell sh to display commands before execution</span>

<span class="c1"># Run the dynamic dns update service</span>

runuser -u ubuntu -- /usr/bin/tmux new-session -s dns -d /usr/local/go/bin/go run /home/ubuntu/go/src/github.com/Airine/dynamic-dns/main.go

<span class="c1"># End</span>

<span class="nb">exit</span> <span class="m">0</span>
</code></pre></div><p>å…³äºåå°è¿è¡Œï¼Œæˆ‘ä½¿ç”¨äº†<a href="https://github.com/tmux/tmux"><code>tmux</code></a>è¿™ä¸ªå·¥å…·(ä¸€æ¬¾ä¼˜ç§€çš„ç»ˆç«¯å¤ç”¨è½¯ä»¶)ã€‚ç”±äº<code>/etc/rc.local</code>ä¼šä½¿ç”¨<code>root</code>èº«ä»½æ‰§è¡Œï¼Œè€Œæˆ‘çš„<code>tmux</code> å’Œ<code>go</code>éƒ½å±äº<code>ubuntu</code>ã€‚è¿™é‡Œä½¿ç”¨äº†<code>runuser -u &lt;username&gt; -- &lt;command&gt;</code>å‘½ä»¤ï¼Œå¯ä»¥ä»¥ä»»æ„<code>user</code>èº«ä»½æ‰§è¡Œ<code>--</code>åçš„å‘½ä»¤ã€‚</p>
<h3 id="æ¨è">æ¨è</h3>
<ol>
<li>
<p>Golang <a href="https://gist.github.com/Airine/2e6b751ecec5f52f3ca859213037d176">dynamicDNS.go</a></p>
</li>
<li>
<p>å¼€æœºå¯åŠ¨è„šæœ¬ <a href="https://gist.github.com/Airine/e4673aa84507ab90e24c7a250a94308d">rc.local.sh</a></p>
</li>
<li>
<p><a href="http://louiszhai.github.io/2017/09/30/tmux/">tmux ä½¿ç”¨æ‰‹å†Œ</a></p>
</li>
</ol></div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://www.aaron-xin.tech/tags/go/">Go</a>
                                    
                                    <a href="https://www.aaron-xin.tech/tags/raspberry-pi/">Raspberry Pi</a>
                                    
                                    <a href="https://www.aaron-xin.tech/tags/dns/">DNS</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                
<div class="doc_comments">
	<div id="gitalk-container"></div>
</div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    const gitalk = new Gitalk({
      clientID: '5a14503d87feacefcfaf',
      clientSecret: 'efb7551dee0e32cd12cb778b4ae8ab9c0150eb8c',
      repo: 'Airine.github.io',
      owner: 'Airine',
      admin: ['Airine'],
      id: location.pathname, 
      distractionFreeMode: false 
    });
    (function() {
      if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
        document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
        return;
      }
      gitalk.render('gitalk-container');
    })();
  </script>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>å¿ƒä¸­æœ‰çˆ±ï¼Œçœ¼é‡Œæœ‰å…‰</span>
    </div>
    <script>
        daovoice('init', {
            app_id: "c9abd2b4"
        });
        daovoice('update');
    </script>
</footer>
    <script src="https://www.aaron-xin.tech/js/jquery-3.5.1.min.js"></script>
<link href="https://www.aaron-xin.tech/css/fancybox.min.css" rel="stylesheet">
<script src="https://www.aaron-xin.tech/js/fancybox.min.js"></script>
<script src="https://www.aaron-xin.tech/js/zozo.js"></script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-162317692-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>